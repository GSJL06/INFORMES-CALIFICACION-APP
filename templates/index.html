{% extends 'base.html' %} {% block title %}Nuevo Informe - {{ app_name }}{%
endblock %} {% block content %}
<div class="form-container">
  <div class="form-header">
    <h1>üìã Generador de Informe de Calificaci√≥n de Desempe√±o</h1>
    <p>Sistema de Telemetr√≠a - Complete los campos para generar el informe</p>
  </div>

  <form
    action="{{ url_for('generar_informe') }}"
    method="POST"
    enctype="multipart/form-data"
    id="informeForm"
  >
    <!-- SECCI√ìN: Metadatos del Documento -->
    <div class="form-section">
      <h2>üìÑ Metadatos del Documento</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="codigo">C√≥digo del documento</label>
          <input
            type="text"
            id="codigo"
            name="codigo"
            value="NXOP-IN-03"
            required
          />
        </div>
        <div class="form-group">
          <label for="version">Versi√≥n</label>
          <input type="text" id="version" name="version" value="01" required />
        </div>
        <div class="form-group">
          <label for="vigencia">Vigencia</label>
          <input type="date" id="vigencia" name="vigencia" required />
        </div>
        <div class="form-group">
          <label for="proceso">Proceso</label>
          <input
            type="text"
            id="proceso"
            name="proceso"
            value="Customer Success Manager"
          />
        </div>
        <div class="form-group">
          <label for="total_paginas">Total de P√°ginas</label>
          <input
            type="number"
            id="total_paginas"
            name="total_paginas"
            value="10"
            min="1"
            max="100"
          />
        </div>
      </div>
    </div>

    <!-- SECCI√ìN: Informaci√≥n Principal -->
    <div class="form-section">
      <h2>üè• Informaci√≥n Principal</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="titulo">T√≠tulo del Sistema</label>
          <input
            type="text"
            id="titulo"
            name="titulo"
            value="Sistema de telemetr√≠a Mi Monitor"
            required
          />
        </div>
        <div class="form-group">
          <label for="numero_informe">N√∫mero de Informe</label>
          <input
            type="text"
            id="numero_informe"
            name="numero_informe"
            placeholder="Ej: N¬∞ 3"
            required
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="nombre_establecimiento">Nombre del Establecimiento</label>
          <input
            type="text"
            id="nombre_establecimiento"
            name="nombre_establecimiento"
            placeholder="Ej: Hospital Pablo Tob√≥n Uribe"
            required
          />
        </div>
        <div class="form-group">
          <label for="direccion_establecimiento"
            >Direcci√≥n del Establecimiento</label
          >
          <input
            type="text"
            id="direccion_establecimiento"
            name="direccion_establecimiento"
            placeholder="Ej: Calle 78 B # 69 - 240"
            required
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="fecha_calificacion">Fecha de Calificaci√≥n</label>
          <input
            type="date"
            id="fecha_calificacion"
            name="fecha_calificacion"
            required
          />
        </div>
        <div class="form-group">
          <label for="logo_cliente">Logo del Cliente (opcional)</label>
          <input
            type="file"
            id="logo_cliente"
            name="logo_cliente"
            accept="image/*"
          />
        </div>
      </div>
    </div>

    <!-- SECCI√ìN: Responsables NETUX -->
    <div class="form-section">
      <h2>üë§ Responsables NETUX</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="elaboro_nombre">Elabor√≥ - Nombre</label>
          <input
            type="text"
            id="elaboro_nombre"
            name="elaboro_nombre"
            required
          />
        </div>
        <div class="form-group">
          <label for="elaboro_cargo">Elabor√≥ - Cargo</label>
          <input
            type="text"
            id="elaboro_cargo"
            name="elaboro_cargo"
            value="Customer Success Manager"
          />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="reviso_nombre">Revis√≥ - Nombre</label>
          <input type="text" id="reviso_nombre" name="reviso_nombre" required />
        </div>
        <div class="form-group">
          <label for="reviso_cargo">Revis√≥ - Cargo</label>
          <input
            type="text"
            id="reviso_cargo"
            name="reviso_cargo"
            value="Director de operaciones"
          />
        </div>
      </div>
    </div>

    <!-- SECCI√ìN: Responsables Cliente -->
    <div class="form-section">
      <h2>üè¢ Responsables del Cliente (Aprobaci√≥n)</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="aprobo_nombre">Aprob√≥ - Nombre</label>
          <input type="text" id="aprobo_nombre" name="aprobo_nombre" required />
        </div>
        <div class="form-group">
          <label for="aprobo_cargo">Aprob√≥ - Cargo</label>
          <input
            type="text"
            id="aprobo_cargo"
            name="aprobo_cargo"
            placeholder="Ej: Ingeniero Unidad de Mec√°nica"
          />
        </div>
        <div class="form-group">
          <label for="aprobo_entidad">Aprob√≥ - Entidad</label>
          <input
            type="text"
            id="aprobo_entidad"
            name="aprobo_entidad"
            placeholder="Nombre del Hospital/Empresa"
          />
        </div>
      </div>
      <div class="form-group">
        <label for="fecha_elaboracion">Fecha de Elaboraci√≥n del Informe</label>
        <input
          type="date"
          id="fecha_elaboracion"
          name="fecha_elaboracion"
          required
        />
      </div>
    </div>

    <!-- SECCI√ìN: Dispositivos -->
    <div class="form-section">
      <h2>üå°Ô∏è Dispositivos en Prueba</h2>
      <p class="section-desc">
        Agregue los dispositivos sometidos a prueba de desempe√±o con sus
        capturas de pantalla de la plataforma Netux
      </p>
      <div id="dispositivos-container" class="dynamic-fields">
        <div class="dynamic-item" data-index="0">
          <button type="button" class="remove-btn" onclick="removeItem(this)">
            √ó
          </button>
          <div class="form-row">
            <div class="form-group" style="flex: 2">
              <label>Nombre/ID del Dispositivo</label>
              <input
                type="text"
                name="dispositivo_nombre[]"
                placeholder="Ej: PRF196 NEVERA MED. FAST TRACK-P2-TA"
              />
            </div>
            <div class="form-group">
              <label>Captura de pantalla (evidencia)</label>
              <input
                type="file"
                name="dispositivo_evidencia[]"
                accept="image/*"
              />
            </div>
          </div>
        </div>
      </div>
      <button type="button" class="add-item-btn" onclick="addDispositivo()">
        + Agregar Dispositivo
      </button>
    </div>

    <!-- SECCI√ìN: Contactos -->
    <div class="form-section">
      <h2>üìû Contactos de Notificaci√≥n</h2>
      <p class="section-desc">
        Personal encargado de recibir las notificaciones de alarma
      </p>
      <div id="contactos-container" class="dynamic-fields">
        <div class="dynamic-item" data-index="0">
          <button type="button" class="remove-btn" onclick="removeItem(this)">
            √ó
          </button>
          <div class="form-row">
            <div class="form-group">
              <label>Nombre Responsable</label>
              <input
                type="text"
                name="contacto_nombre[]"
                placeholder="Nombre completo"
              />
            </div>
            <div class="form-group">
              <label>Tel√©fono</label>
              <input
                type="tel"
                name="contacto_telefono[]"
                placeholder="Ej: 3001234567"
              />
            </div>
            <div class="form-group">
              <label>Correo Electr√≥nico</label>
              <input
                type="email"
                name="contacto_correo[]"
                placeholder="correo@ejemplo.com"
              />
            </div>
          </div>
        </div>
      </div>
      <button type="button" class="add-item-btn" onclick="addContacto()">
        + Agregar Contacto
      </button>
    </div>

    <!-- SECCI√ìN: Evidencias Fotogr√°ficas -->
    <div class="form-section">
      <h2>üì∏ Evidencias Fotogr√°ficas</h2>
      <p class="section-desc">
        Suba capturas de pantalla o fotos de las pruebas realizadas
      </p>
      <div class="form-group">
        <label for="evidencias">Seleccionar im√°genes (m√∫ltiples)</label>
        <input
          type="file"
          id="evidencias"
          name="evidencias[]"
          accept="image/*"
          multiple
        />
      </div>
    </div>

    <!-- SECCI√ìN: Resultados y Conclusiones -->
    <div class="form-section">
      <h2>üìä Resultados y Conclusiones</h2>
      <div class="form-group">
        <label for="resultados">Resultados de la Calificaci√≥n</label>
        <textarea
          id="resultados"
          name="resultados"
          placeholder="Describa los resultados obtenidos durante la calificaci√≥n de desempe√±o del sistema..."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="conclusiones">Conclusiones</label>
        <textarea
          id="conclusiones"
          name="conclusiones"
          placeholder="Describa las conclusiones del informe de calificaci√≥n..."
        ></textarea>
      </div>
    </div>

    <!-- SECCI√ìN: Desviaciones -->
    <div class="form-section">
      <h2>‚ö†Ô∏è Informe de Desviaciones</h2>
      <div class="form-group">
        <label for="desviaciones">Desviaci√≥n(es)</label>
        <textarea
          id="desviaciones"
          name="desviaciones"
          placeholder="No se presentaron desviaciones"
        >
No se presentaron desviaciones</textarea
        >
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="justificacion_desviacion"
            >Justificaci√≥n de la Aceptaci√≥n</label
          >
          <input
            type="text"
            id="justificacion_desviacion"
            name="justificacion_desviacion"
            value="No aplica"
          />
        </div>
        <div class="form-group">
          <label for="impacto_desviacion">Impacto sobre la Operaci√≥n</label>
          <input
            type="text"
            id="impacto_desviacion"
            name="impacto_desviacion"
            value="No aplica"
          />
        </div>
      </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="btn-group">
      <button type="submit" class="btn btn-primary">
        üìÑ Generar Vista Previa
      </button>
      <button type="reset" class="btn btn-secondary">
        üîÑ Limpiar Formulario
      </button>
    </div>
  </form>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Funciones para campos din√°micos
  function addDispositivo() {
    const container = document.getElementById("dispositivos-container");
    const index = container.children.length;
    const html = `
        <div class="dynamic-item" data-index="${index}">
            <button type="button" class="remove-btn" onclick="removeItem(this)">√ó</button>
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label>Nombre/ID del Dispositivo</label>
                    <input type="text" name="dispositivo_nombre[]" placeholder="Ej: PRF196 NEVERA MED. FAST TRACK-P2-TA">
                </div>
                <div class="form-group">
                    <label>Captura de pantalla (evidencia)</label>
                    <input type="file" name="dispositivo_evidencia[]" accept="image/*">
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML("beforeend", html);
  }

  function addContacto() {
    const container = document.getElementById("contactos-container");
    const index = container.children.length;
    const html = `
        <div class="dynamic-item" data-index="${index}">
            <button type="button" class="remove-btn" onclick="removeItem(this)">√ó</button>
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre Responsable</label>
                    <input type="text" name="contacto_nombre[]" placeholder="Nombre completo">
                </div>
                <div class="form-group">
                    <label>Tel√©fono</label>
                    <input type="tel" name="contacto_telefono[]" placeholder="Ej: 3001234567">
                </div>
                <div class="form-group">
                    <label>Correo Electr√≥nico</label>
                    <input type="email" name="contacto_correo[]" placeholder="correo@ejemplo.com">
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML("beforeend", html);
  }

  function removeItem(btn) {
    const item = btn.closest(".dynamic-item");
    const container = item.parentElement;
    if (container.children.length > 1) {
      item.remove();
    } else {
      alert("Debe mantener al menos un elemento");
    }
  }
</script>
{% endblock %}
